version: api.keploy.io/v1beta1
kind: SQL
name: test-198-0
spec:
    metadata:
        name: SQL
        operation: PrepareContext
        query: '"SELECT * FROM subscribers WHERE CASE WHEN $1 > 0 THEN id = $1 WHEN $2 != '''' THEN uuid = $2::UUID WHEN $3 != '''' THEN email = $3 END;"'
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-1
spec:
    metadata:
        name: SQL
        operation: PrepareContext.NumInput
        type: SQL_DB
    type: int
    int: 3
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-2
spec:
    metadata:
        arguments: '[{ 1 0} { 2 3d0317cf-584d-48c9-b53f-5ddb2b441510} { 3 }]'
        name: SQL
        operation: QueryContext
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-3
spec:
    metadata:
        name: SQL
        operation: QueryContext.Close
        type: SQL_DB
    type: table
    table:
        cols:
            - name: id
              type: int64
              precision: 0
              scale: 0
            - name: uuid
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: email
              type: string
              precision: 0
              scale: 0
            - name: name
              type: string
              precision: 0
              scale: 0
            - name: attribs
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: status
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: created_at
              type: time.Time
              precision: 0
              scale: 0
            - name: updated_at
              type: time.Time
              precision: 0
              scale: 0
        rows:
            - '[`2` | `[51 100 48 51 49 55 99 102 45 53 56 52 100 45 52 56 99 57 45 98 53 51 102 45 53 100 100 98 50 98 52 52 49 53 49 48]` | `anon@example.com` | `Anon Doe` | `[123 34 99 105 116 121 34 58 32 34 66 101 110 103 97 108 117 114 117 34 44 32 34 103 111 111 100 34 58 32 116 114 117 101 44 32 34 116 121 112 101 34 58 32 34 117 110 107 110 111 119 110 34 125]` | `[101 110 97 98 108 101 100]` | `"2023-01-06T07:39:21.465857Z"` | `"2023-01-07T08:32:14.491287Z"` | ]'
            - '[`2` | `[51 100 48 51 49 55 99 102 45 53 56 52 100 45 52 56 99 57 45 98 53 51 102 45 53 100 100 98 50 98 52 52 49 53 49 48]` | `anon@example.com` | `Anon Doe` | `[123 34 99 105 116 121 34 58 32 34 66 101 110 103 97 108 117 114 117 34 44 32 34 103 111 111 100 34 58 32 116 114 117 101 44 32 34 116 121 112 101 34 58 32 34 117 110 107 110 111 119 110 34 125]` | `[101 110 97 98 108 101 100]` | `"2023-01-06T07:39:21.465857Z"` | `"2023-01-07T08:32:14.491287Z"` | ]'
    int: 0
    error:
        - nil
        - EOF
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-4
spec:
    metadata:
        name: SQL
        operation: PrepareContext.Close
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-5
spec:
    metadata:
        name: SQL
        operation: PrepareContext
        query: '"WITH subs AS ( SELECT subscriber_id, JSON_AGG( ROW_TO_JSON( (SELECT l FROM ( SELECT subscriber_lists.status AS subscription_status, subscriber_lists.created_at AS subscription_created_at, subscriber_lists.updated_at AS subscription_updated_at, lists.* ) l) ) ) AS lists FROM lists LEFT JOIN subscriber_lists ON (subscriber_lists.list_id = lists.id) WHERE subscriber_lists.subscriber_id = ANY($1) GROUP BY subscriber_id ) SELECT id as subscriber_id, COALESCE(s.lists, ''[]'') AS lists FROM (SELECT id FROM UNNEST($1) AS id) x LEFT JOIN subs AS s ON (s.subscriber_id = id) ORDER BY ARRAY_POSITION($1, id);"'
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-6
spec:
    metadata:
        name: SQL
        operation: PrepareContext.NumInput
        type: SQL_DB
    type: int
    int: 1
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-7
spec:
    metadata:
        arguments: '[{ 1 {2}}]'
        name: SQL
        operation: QueryContext
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-8
spec:
    metadata:
        name: SQL
        operation: QueryContext.Close
        type: SQL_DB
    type: table
    table:
        cols:
            - name: subscriber_id
              type: int64
              precision: 0
              scale: 0
            - name: lists
              type: '[]uint8'
              precision: 0
              scale: 0
        rows:
            - '[`2` | `[91 93]` | ]'
            - '[`2` | `[91 93]` | ]'
    int: 0
    error:
        - nil
        - EOF
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-9
spec:
    metadata:
        name: SQL
        operation: PrepareContext.Close
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-10
spec:
    metadata:
        name: SQL
        operation: PrepareContext
        query: '"WITH sub AS ( SELECT id FROM subscribers WHERE CASE WHEN $1 > 0 THEN id = $1 ELSE uuid = $2 END ) SELECT lists.*, subscriber_lists.status as subscription_status, subscriber_lists.created_at as subscription_created_at FROM lists LEFT JOIN subscriber_lists ON (subscriber_lists.list_id = lists.id AND subscriber_lists.subscriber_id = (SELECT id FROM sub)) WHERE CASE WHEN $3 = TRUE THEN TRUE ELSE subscriber_lists.status IS NOT NULL END ORDER BY subscriber_lists.status;"'
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-11
spec:
    metadata:
        name: SQL
        operation: PrepareContext.NumInput
        type: SQL_DB
    type: int
    int: 3
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-12
spec:
    metadata:
        arguments: '[{ 1 0} { 2 3d0317cf-584d-48c9-b53f-5ddb2b441510} { 3 false}]'
        name: SQL
        operation: QueryContext
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-13
spec:
    metadata:
        name: SQL
        operation: QueryContext.Close
        type: SQL_DB
    type: table
    table:
        cols:
            - name: id
              type: <nil>
              precision: 0
              scale: 0
            - name: uuid
              type: <nil>
              precision: 0
              scale: 0
            - name: name
              type: <nil>
              precision: 0
              scale: 0
            - name: type
              type: <nil>
              precision: 0
              scale: 0
            - name: optin
              type: <nil>
              precision: 0
              scale: 0
            - name: tags
              type: <nil>
              precision: 0
              scale: 0
            - name: description
              type: <nil>
              precision: 0
              scale: 0
            - name: created_at
              type: <nil>
              precision: 0
              scale: 0
            - name: updated_at
              type: <nil>
              precision: 0
              scale: 0
            - name: subscription_status
              type: <nil>
              precision: 0
              scale: 0
            - name: subscription_created_at
              type: <nil>
              precision: 0
              scale: 0
        rows:
            - '[`<nil>` | `<nil>` | `<nil>` | `<nil>` | `<nil>` | `<nil>` | `<nil>` | `<nil>` | `<nil>` | `<nil>` | `<nil>` | ]'
    int: 0
    error:
        - EOF
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-14
spec:
    metadata:
        name: SQL
        operation: PrepareContext.Close
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-15
spec:
    metadata:
        name: SQL
        operation: PrepareContext
        query: '"SELECT * FROM subscribers WHERE CASE WHEN $1 > 0 THEN id = $1 WHEN $2 != '''' THEN uuid = $2::UUID WHEN $3 != '''' THEN email = $3 END;"'
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-16
spec:
    metadata:
        name: SQL
        operation: PrepareContext.NumInput
        type: SQL_DB
    type: int
    int: 3
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-17
spec:
    metadata:
        arguments: '[{ 1 0} { 2 3d0317cf-584d-48c9-b53f-5ddb2b441510} { 3 }]'
        name: SQL
        operation: QueryContext
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-18
spec:
    metadata:
        name: SQL
        operation: QueryContext.Close
        type: SQL_DB
    type: table
    table:
        cols:
            - name: id
              type: int64
              precision: 0
              scale: 0
            - name: uuid
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: email
              type: string
              precision: 0
              scale: 0
            - name: name
              type: string
              precision: 0
              scale: 0
            - name: attribs
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: status
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: created_at
              type: time.Time
              precision: 0
              scale: 0
            - name: updated_at
              type: time.Time
              precision: 0
              scale: 0
        rows:
            - '[`2` | `[51 100 48 51 49 55 99 102 45 53 56 52 100 45 52 56 99 57 45 98 53 51 102 45 53 100 100 98 50 98 52 52 49 53 49 48]` | `anon@example.com` | `Anon Doe` | `[123 34 99 105 116 121 34 58 32 34 66 101 110 103 97 108 117 114 117 34 44 32 34 103 111 111 100 34 58 32 116 114 117 101 44 32 34 116 121 112 101 34 58 32 34 117 110 107 110 111 119 110 34 125]` | `[101 110 97 98 108 101 100]` | `"2023-01-06T07:39:21.465857Z"` | `"2023-01-07T08:32:14.491287Z"` | ]'
            - '[`2` | `[51 100 48 51 49 55 99 102 45 53 56 52 100 45 52 56 99 57 45 98 53 51 102 45 53 100 100 98 50 98 52 52 49 53 49 48]` | `anon@example.com` | `Anon Doe` | `[123 34 99 105 116 121 34 58 32 34 66 101 110 103 97 108 117 114 117 34 44 32 34 103 111 111 100 34 58 32 116 114 117 101 44 32 34 116 121 112 101 34 58 32 34 117 110 107 110 111 119 110 34 125]` | `[101 110 97 98 108 101 100]` | `"2023-01-06T07:39:21.465857Z"` | `"2023-01-07T08:32:14.491287Z"` | ]'
    int: 0
    error:
        - nil
        - EOF
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-19
spec:
    metadata:
        name: SQL
        operation: PrepareContext.Close
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-20
spec:
    metadata:
        name: SQL
        operation: PrepareContext
        query: '"WITH subs AS ( SELECT subscriber_id, JSON_AGG( ROW_TO_JSON( (SELECT l FROM ( SELECT subscriber_lists.status AS subscription_status, subscriber_lists.created_at AS subscription_created_at, subscriber_lists.updated_at AS subscription_updated_at, lists.* ) l) ) ) AS lists FROM lists LEFT JOIN subscriber_lists ON (subscriber_lists.list_id = lists.id) WHERE subscriber_lists.subscriber_id = ANY($1) GROUP BY subscriber_id ) SELECT id as subscriber_id, COALESCE(s.lists, ''[]'') AS lists FROM (SELECT id FROM UNNEST($1) AS id) x LEFT JOIN subs AS s ON (s.subscriber_id = id) ORDER BY ARRAY_POSITION($1, id);"'
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-21
spec:
    metadata:
        name: SQL
        operation: PrepareContext.NumInput
        type: SQL_DB
    type: int
    int: 1
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-22
spec:
    metadata:
        arguments: '[{ 1 {2}}]'
        name: SQL
        operation: QueryContext
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-23
spec:
    metadata:
        name: SQL
        operation: QueryContext.Close
        type: SQL_DB
    type: table
    table:
        cols:
            - name: subscriber_id
              type: int64
              precision: 0
              scale: 0
            - name: lists
              type: '[]uint8'
              precision: 0
              scale: 0
        rows:
            - '[`2` | `[91 93]` | ]'
            - '[`2` | `[91 93]` | ]'
    int: 0
    error:
        - nil
        - EOF
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-198-24
spec:
    metadata:
        name: SQL
        operation: PrepareContext.Close
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
