version: api.keploy.io/v1beta1
kind: SQL
name: test-162-0
spec:
    metadata:
        name: SQL
        operation: PrepareContext
        query: '"SELECT * FROM subscribers WHERE email=ANY($1);"'
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-162-1
spec:
    metadata:
        name: SQL
        operation: PrepareContext.NumInput
        type: SQL_DB
    type: int
    int: 1
    error: []
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-162-2
spec:
    metadata:
        arguments: '[{ 1 {"sarthak@keploy.io"}}]'
        name: SQL
        operation: QueryContext
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-162-3
spec:
    metadata:
        name: SQL
        operation: QueryContext.Close
        type: SQL_DB
    type: table
    table:
        cols:
            - name: id
              type: int64
              precision: 0
              scale: 0
            - name: uuid
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: email
              type: string
              precision: 0
              scale: 0
            - name: name
              type: string
              precision: 0
              scale: 0
            - name: attribs
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: status
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: created_at
              type: time.Time
              precision: 0
              scale: 0
            - name: updated_at
              type: time.Time
              precision: 0
              scale: 0
        rows:
            - '[`3` | `[50 57 98 49 100 102 55 55 45 53 100 50 100 45 52 97 55 48 45 97 49 51 48 45 57 101 57 55 51 49 51 99 102 56 100 99]` | `sarthak@keploy.io` | `Sarthak` | `[110 117 108 108]` | `[101 110 97 98 108 101 100]` | `"2022-12-22T12:37:53.167609Z"` | `"2022-12-22T12:37:53.167609Z"` | ]'
            - '[`3` | `[50 57 98 49 100 102 55 55 45 53 100 50 100 45 52 97 55 48 45 97 49 51 48 45 57 101 57 55 51 49 51 99 102 56 100 99]` | `sarthak@keploy.io` | `Sarthak` | `[110 117 108 108]` | `[101 110 97 98 108 101 100]` | `"2022-12-22T12:37:53.167609Z"` | `"2022-12-22T12:37:53.167609Z"` | ]'
    int: 0
    error:
        - nil
        - EOF
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-162-4
spec:
    metadata:
        name: SQL
        operation: PrepareContext.Close
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-162-5
spec:
    metadata:
        name: SQL
        operation: PrepareContext
        query: '"WITH subs AS ( SELECT subscriber_id, JSON_AGG( ROW_TO_JSON( (SELECT l FROM (SELECT subscriber_lists.status AS subscription_status, lists.*) l) ) ) AS lists FROM lists LEFT JOIN subscriber_lists ON (subscriber_lists.list_id = lists.id) WHERE subscriber_lists.subscriber_id = ANY($1) GROUP BY subscriber_id ) SELECT id as subscriber_id, COALESCE(s.lists, ''[]'') AS lists FROM (SELECT id FROM UNNEST($1) AS id) x LEFT JOIN subs AS s ON (s.subscriber_id = id) ORDER BY ARRAY_POSITION($1, id);"'
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-162-6
spec:
    metadata:
        name: SQL
        operation: PrepareContext.NumInput
        type: SQL_DB
    type: int
    int: 1
    error: []
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-162-7
spec:
    metadata:
        arguments: '[{ 1 {3}}]'
        name: SQL
        operation: QueryContext
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-162-8
spec:
    metadata:
        name: SQL
        operation: QueryContext.Close
        type: SQL_DB
    type: table
    table:
        cols:
            - name: subscriber_id
              type: int64
              precision: 0
              scale: 0
            - name: lists
              type: '[]uint8'
              precision: 0
              scale: 0
        rows:
            - '[`3` | `[91 123 34 115 117 98 115 99 114 105 112 116 105 111 110 95 115 116 97 116 117 115 34 58 34 117 110 99 111 110 102 105 114 109 101 100 34 44 34 105 100 34 58 50 44 34 117 117 105 100 34 58 34 55 98 53 102 57 49 51 100 45 57 100 55 53 45 52 49 51 101 45 57 97 54 50 45 57 57 50 57 97 51 99 52 53 97 49 98 34 44 34 110 97 109 101 34 58 34 79 112 116 45 105 110 32 108 105 115 116 34 44 34 116 121 112 101 34 58 34 112 117 98 108 105 99 34 44 34 111 112 116 105 110 34 58 34 100 111 117 98 108 101 34 44 34 116 97 103 115 34 58 91 34 116 101 115 116 34 93 44 34 99 114 101 97 116 101 100 95 97 116 34 58 34 50 48 50 50 45 49 50 45 50 50 84 48 57 58 48 50 58 49 54 46 57 49 53 53 49 51 43 48 48 58 48 48 34 44 34 117 112 100 97 116 101 100 95 97 116 34 58 34 50 48 50 50 45 49 50 45 50 50 84 48 57 58 48 50 58 49 54 46 57 49 53 53 49 51 43 48 48 58 48 48 34 125 44 32 123 34 115 117 98 115 99 114 105 112 116 105 111 110 95 115 116 97 116 117 115 34 58 34 117 110 99 111 110 102 105 114 109 101 100 34 44 34 105 100 34 58 49 44 34 117 117 105 100 34 58 34 52 50 49 99 102 51 53 56 45 102 54 56 51 45 52 53 101 55 45 97 52 50 55 45 57 99 101 55 100 50 98 102 50 97 57 101 34 44 34 110 97 109 101 34 58 34 68 101 102 97 117 108 116 32 108 105 115 116 34 44 34 116 121 112 101 34 58 34 112 117 98 108 105 99 34 44 34 111 112 116 105 110 34 58 34 115 105 110 103 108 101 34 44 34 116 97 103 115 34 58 91 34 116 101 115 116 34 93 44 34 99 114 101 97 116 101 100 95 97 116 34 58 34 50 48 50 50 45 49 50 45 50 50 84 48 57 58 48 50 58 49 54 46 57 49 52 53 55 56 43 48 48 58 48 48 34 44 34 117 112 100 97 116 101 100 95 97 116 34 58 34 50 48 50 50 45 49 50 45 50 50 84 49 48 58 51 50 58 50 55 46 54 51 52 56 50 51 43 48 48 58 48 48 34 125 93]` | ]'
            - '[`3` | `[91 123 34 115 117 98 115 99 114 105 112 116 105 111 110 95 115 116 97 116 117 115 34 58 34 117 110 99 111 110 102 105 114 109 101 100 34 44 34 105 100 34 58 50 44 34 117 117 105 100 34 58 34 55 98 53 102 57 49 51 100 45 57 100 55 53 45 52 49 51 101 45 57 97 54 50 45 57 57 50 57 97 51 99 52 53 97 49 98 34 44 34 110 97 109 101 34 58 34 79 112 116 45 105 110 32 108 105 115 116 34 44 34 116 121 112 101 34 58 34 112 117 98 108 105 99 34 44 34 111 112 116 105 110 34 58 34 100 111 117 98 108 101 34 44 34 116 97 103 115 34 58 91 34 116 101 115 116 34 93 44 34 99 114 101 97 116 101 100 95 97 116 34 58 34 50 48 50 50 45 49 50 45 50 50 84 48 57 58 48 50 58 49 54 46 57 49 53 53 49 51 43 48 48 58 48 48 34 44 34 117 112 100 97 116 101 100 95 97 116 34 58 34 50 48 50 50 45 49 50 45 50 50 84 48 57 58 48 50 58 49 54 46 57 49 53 53 49 51 43 48 48 58 48 48 34 125 44 32 123 34 115 117 98 115 99 114 105 112 116 105 111 110 95 115 116 97 116 117 115 34 58 34 117 110 99 111 110 102 105 114 109 101 100 34 44 34 105 100 34 58 49 44 34 117 117 105 100 34 58 34 52 50 49 99 102 51 53 56 45 102 54 56 51 45 52 53 101 55 45 97 52 50 55 45 57 99 101 55 100 50 98 102 50 97 57 101 34 44 34 110 97 109 101 34 58 34 68 101 102 97 117 108 116 32 108 105 115 116 34 44 34 116 121 112 101 34 58 34 112 117 98 108 105 99 34 44 34 111 112 116 105 110 34 58 34 115 105 110 103 108 101 34 44 34 116 97 103 115 34 58 91 34 116 101 115 116 34 93 44 34 99 114 101 97 116 101 100 95 97 116 34 58 34 50 48 50 50 45 49 50 45 50 50 84 48 57 58 48 50 58 49 54 46 57 49 52 53 55 56 43 48 48 58 48 48 34 44 34 117 112 100 97 116 101 100 95 97 116 34 58 34 50 48 50 50 45 49 50 45 50 50 84 49 48 58 51 50 58 50 55 46 54 51 52 56 50 51 43 48 48 58 48 48 34 125 93]` | ]'
    int: 0
    error:
        - nil
        - EOF
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-162-9
spec:
    metadata:
        name: SQL
        operation: PrepareContext.Close
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-162-10
spec:
    metadata:
        name: SQL
        operation: PrepareContext
        query: "\"SELECT campaigns.*, COALESCE(templates.body, (SELECT body FROM templates WHERE is_default = true LIMIT 1)) AS template_body, ( \tSELECT COALESCE(ARRAY_TO_JSON(ARRAY_AGG(l)), '[]') FROM ( \t\tSELECT COALESCE(campaign_lists.list_id, 0) AS id, campaign_lists.list_name AS name FROM campaign_lists WHERE campaign_lists.campaign_id = campaigns.id \t) l ) AS lists FROM campaigns LEFT JOIN templates ON (templates.id = (CASE WHEN $2=0 THEN campaigns.template_id ELSE $2 END)) WHERE campaigns.id = $1;\""
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-162-11
spec:
    metadata:
        name: SQL
        operation: PrepareContext.NumInput
        type: SQL_DB
    type: int
    int: 2
    error: []
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-162-12
spec:
    metadata:
        arguments: '[{ 1 12} { 2 0}]'
        name: SQL
        operation: QueryContext
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-162-13
spec:
    metadata:
        name: SQL
        operation: QueryContext.Close
        type: SQL_DB
    type: table
    table:
        cols:
            - name: id
              type: int64
              precision: 0
              scale: 0
            - name: uuid
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: name
              type: string
              precision: 0
              scale: 0
            - name: subject
              type: string
              precision: 0
              scale: 0
            - name: from_email
              type: string
              precision: 0
              scale: 0
            - name: body
              type: string
              precision: 0
              scale: 0
            - name: altbody
              type: <nil>
              precision: 0
              scale: 0
            - name: content_type
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: send_at
              type: <nil>
              precision: 0
              scale: 0
            - name: headers
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: status
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: tags
              type: <nil>
              precision: 0
              scale: 0
            - name: type
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: messenger
              type: string
              precision: 0
              scale: 0
            - name: template_id
              type: int64
              precision: 0
              scale: 0
            - name: to_send
              type: int64
              precision: 0
              scale: 0
            - name: sent
              type: int64
              precision: 0
              scale: 0
            - name: max_subscriber_id
              type: int64
              precision: 0
              scale: 0
            - name: last_subscriber_id
              type: int64
              precision: 0
              scale: 0
            - name: started_at
              type: <nil>
              precision: 0
              scale: 0
            - name: created_at
              type: time.Time
              precision: 0
              scale: 0
            - name: updated_at
              type: time.Time
              precision: 0
              scale: 0
            - name: template_body
              type: string
              precision: 0
              scale: 0
            - name: lists
              type: '[]uint8'
              precision: 0
              scale: 0
        rows:
            - "[`12` | `[97 97 49 100 52 51 56 52 45 98 54 52 48 45 52 48 101 97 45 98 98 52 57 45 100 101 100 102 48 48 48 49 55 56 55 49]` | `sample-optin` | `sample-optin` | `ritik@keploy.io` | `\n\n<p>Hi {{.Subscriber.FirstName }}</p>\n<p>You have been added to the following lists:</p>\n<ul>\n    \n        \n            <li>Private list</li>\n        \n    \n</ul>\n<p>\n    <a class=\"button\" href=\"{{ OptinURL }}l=df69e33d-e1f4-4f9b-a53b-9e059396cf3a\">Confirm subscription</a>\n</p>\n` | `<nil>` | `[114 105 99 104 116 101 120 116]` | `<nil>` | `[91 93]` | `[100 114 97 102 116]` | `<nil>` | `[111 112 116 105 110]` | `email` | `1` | `0` | `0` | `0` | `0` | `<nil>` | `\"2022-12-23T10:29:13.799254Z\"` | `\"2022-12-23T10:29:13.799254Z\"` | `<!doctype html>\n<html>\n    <head>\n        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, minimum-scale=1\">\n        <base target=\"_blank\">\n\n        <style>\n            body {\n                background-color: #F0F1F3;\n                font-family: 'Helvetica Neue', 'Segoe UI', Helvetica, sans-serif;\n                font-size: 15px;\n                line-height: 26px;\n                margin: 0;\n                color: #444;\n            }\n\n            pre {\n                background: #f4f4f4f4;\n                padding: 2px;\n            }\n\n            table {\n                width: 100%;\n                border: 1px solid #ddd;\n            }\n            table td {\n                border-color: #ddd;\n                padding: 5px;\n            }\n\n            .wrap {\n                background-color: #fff;\n                padding: 30px;\n                max-width: 525px;\n                margin: 0 auto;\n                border-radius: 5px;\n            }\n\n            .button {\n                background: #0055d4;\n                border-radius: 3px;\n                text-decoration: none !important;\n                color: #fff !important;\n                font-weight: bold;\n                padding: 10px 30px;\n                display: inline-block;\n            }\n            .button:hover {\n                background: #111;\n            }\n\n            .footer {\n                text-align: center;\n                font-size: 12px;\n                color: #888;\n            }\n                .footer a {\n                    color: #888;\n                    margin-right: 5px;\n                }\n\n            .gutter {\n                padding: 30px;\n            }\n\n            img {\n                max-width: 100%;\n                height: auto;\n            }\n\n            a {\n                color: #0055d4;\n            }\n                a:hover {\n                    color: #111;\n                }\n            @media screen and (max-width: 600px) {\n                .wrap {\n                    max-width: auto;\n                }\n                .gutter {\n                    padding: 10px;\n                }\n            }\n        </style>\n    </head>\n<body style=\"background-color: #F0F1F3;font-family: 'Helvetica Neue', 'Segoe UI', Helvetica, sans-serif;font-size: 15px;line-height: 26px;margin: 0;color: #444;\">\n    <div class=\"gutter\" style=\"padding: 30px;\">&nbsp;</div>\n    <div class=\"wrap\" style=\"background-color: #fff;padding: 30px;max-width: 525px;margin: 0 auto;border-radius: 5px;\">\n        {{ template \"content\" . }}\n    </div>\n    \n    <div class=\"footer\" style=\"text-align: center;font-size: 12px;color: #888;\">\n        <p>\n            {{ L.T \"email.unsubHelp\" }}\n            <a href=\"{{ UnsubscribeURL }}\" style=\"color: #888;\">{{ L.T \"email.unsub\" }}</a>\n            <a href=\"{{ MessageURL }}\" style=\"color: #888;\">{{ L.T \"email.viewInBrowser\" }}</a>\n        </p>\n        <p>Powered by <a href=\"https://listmonk.app\" target=\"_blank\" style=\"color: #888;\">listmonk</a></p>\n    </div>\n    <div class=\"gutter\" style=\"padding: 30px;\">&nbsp;{{ TrackView }}</div>\n</body>\n</html>\n` | `[91 123 34 105 100 34 58 51 44 34 110 97 109 101 34 58 34 111 112 116 105 110 34 125 93]` | ]"
    int: 0
    error:
        - nil
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-162-14
spec:
    metadata:
        name: SQL
        operation: PrepareContext.Close
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
