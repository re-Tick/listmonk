version: api.keploy.io/v1beta1
kind: SQL
name: test-25-0
spec:
    metadata:
        name: SQL
        operation: PrepareContext
        query: '"WITH prof AS ( SELECT id, uuid, email, name, attribs, status, created_at, updated_at FROM subscribers WHERE CASE WHEN $1 > 0 THEN id = $1 ELSE uuid = $2 END ), subs AS ( SELECT subscriber_lists.status AS subscription_status, (CASE WHEN lists.type = ''private'' THEN ''Private list'' ELSE lists.name END) as name, lists.type, subscriber_lists.created_at FROM lists LEFT JOIN subscriber_lists ON (subscriber_lists.list_id = lists.id) WHERE subscriber_lists.subscriber_id = (SELECT id FROM prof) ), views AS ( SELECT subject as campaign, COUNT(subscriber_id) as views FROM campaign_views LEFT JOIN campaigns ON (campaigns.id = campaign_views.campaign_id) WHERE subscriber_id = (SELECT id FROM prof) GROUP BY campaigns.id ORDER BY campaigns.id ), clicks AS ( SELECT url, COUNT(subscriber_id) as clicks FROM link_clicks LEFT JOIN links ON (links.id = link_clicks.link_id) WHERE subscriber_id = (SELECT id FROM prof) GROUP BY links.id ORDER BY links.id ) SELECT (SELECT email FROM prof) as email, COALESCE((SELECT JSON_AGG(t) FROM prof t), ''{}'') AS profile, COALESCE((SELECT JSON_AGG(t) FROM subs t), ''[]'') AS subscriptions, COALESCE((SELECT JSON_AGG(t) FROM views t), ''[]'') AS campaign_views, COALESCE((SELECT JSON_AGG(t) FROM clicks t), ''[]'') AS link_clicks;"'
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-25-1
spec:
    metadata:
        name: SQL
        operation: PrepareContext.NumInput
        type: SQL_DB
    type: int
    int: 2
    error: []
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-25-2
spec:
    metadata:
        arguments: '[{ 1 18} { 2 <nil>}]'
        name: SQL
        operation: QueryContext
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-25-3
spec:
    metadata:
        name: SQL
        operation: QueryContext.Close
        type: SQL_DB
    type: table
    table:
        cols:
            - name: email
              type: string
              precision: 0
              scale: 0
            - name: profile
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: subscriptions
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: campaign_views
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: link_clicks
              type: '[]uint8'
              precision: 0
              scale: 0
        rows:
            - '[`gouravkrox@gmail.com` | `[91 123 34 105 100 34 58 49 56 44 34 117 117 105 100 34 58 34 54 102 55 98 55 101 54 51 45 54 49 50 54 45 52 51 98 97 45 97 55 53 102 45 52 55 53 51 52 97 48 56 55 57 56 52 34 44 34 101 109 97 105 108 34 58 34 103 111 117 114 97 118 107 114 111 120 64 103 109 97 105 108 46 99 111 109 34 44 34 110 97 109 101 34 58 34 103 111 117 114 97 118 32 107 117 109 97 114 34 44 34 97 116 116 114 105 98 115 34 58 123 125 44 34 115 116 97 116 117 115 34 58 34 101 110 97 98 108 101 100 34 44 34 99 114 101 97 116 101 100 95 97 116 34 58 34 50 48 50 50 45 49 49 45 48 57 84 48 54 58 53 50 58 49 54 46 52 57 57 57 43 48 48 58 48 48 34 44 34 117 112 100 97 116 101 100 95 97 116 34 58 34 50 48 50 50 45 49 50 45 49 56 84 49 49 58 51 55 58 49 51 46 50 49 55 53 50 51 43 48 48 58 48 48 34 125 93]` | `[91 93]` | `[91 93]` | `[91 93]` | ]'
    int: 0
    error:
        - nil
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-25-4
spec:
    metadata:
        name: SQL
        operation: PrepareContext.Close
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
