version: api.keploy.io/v1beta1
kind: SQL
name: test-191-0
spec:
    metadata:
        arguments: '[{ 1 1} { 2 <nil>} { 3 } { 4 0} { 5 1}]'
        name: SQL
        operation: QueryContext
        query: "\"WITH ls AS ( \tSELECT COUNT(*) OVER () AS total, lists.* FROM lists WHERE CASE WHEN $1 > 0 THEN id = $1 WHEN $2 != '' THEN uuid = $2::UUID WHEN $3 != '' THEN to_tsvector(name) @@ to_tsquery ($3) ELSE true END ORDER BY created_at desc OFFSET $4 LIMIT (CASE WHEN $5 < 1 THEN NULL ELSE $5 END) ), counts AS ( SELECT list_id, JSON_OBJECT_AGG(status, subscriber_count) AS subscriber_statuses FROM ( SELECT COUNT(*) as subscriber_count, list_id, status FROM subscriber_lists WHERE ($1 = 0 OR list_id = $1) GROUP BY list_id, status ) row GROUP BY list_id ) SELECT ls.*, subscriber_statuses FROM ls LEFT JOIN counts ON (counts.list_id = ls.id) ORDER BY created_at desc;\""
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-191-1
spec:
    metadata:
        name: SQL
        operation: QueryContext.Close
        type: SQL_DB
    type: table
    table:
        cols:
            - name: total
              type: int64
              precision: 0
              scale: 0
            - name: id
              type: int64
              precision: 0
              scale: 0
            - name: uuid
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: name
              type: string
              precision: 0
              scale: 0
            - name: type
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: optin
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: tags
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: description
              type: string
              precision: 0
              scale: 0
            - name: created_at
              type: time.Time
              precision: 0
              scale: 0
            - name: updated_at
              type: time.Time
              precision: 0
              scale: 0
            - name: subscriber_statuses
              type: '[]uint8'
              precision: 0
              scale: 0
        rows:
            - '[`1` | `1` | `[50 100 52 101 51 50 49 100 45 101 53 101 56 45 52 50 100 102 45 57 102 99 53 45 53 99 98 53 100 54 50 50 53 56 54 50]` | `Default list` | `[112 114 105 118 97 116 101]` | `[115 105 110 103 108 101]` | `[123 116 101 115 116 125]` | `` | `"2023-01-06T07:39:21.462994Z"` | `"2023-01-06T07:39:21.462994Z"` | `[123 32 34 117 110 99 111 110 102 105 114 109 101 100 34 32 58 32 49 32 125]` | ]'
            - '[`1` | `1` | `[50 100 52 101 51 50 49 100 45 101 53 101 56 45 52 50 100 102 45 57 102 99 53 45 53 99 98 53 100 54 50 50 53 56 54 50]` | `Default list` | `[112 114 105 118 97 116 101]` | `[115 105 110 103 108 101]` | `[123 116 101 115 116 125]` | `` | `"2023-01-06T07:39:21.462994Z"` | `"2023-01-06T07:39:21.462994Z"` | `[123 32 34 117 110 99 111 110 102 105 114 109 101 100 34 32 58 32 49 32 125]` | ]'
    int: 0
    error:
        - nil
        - EOF
        - nil
