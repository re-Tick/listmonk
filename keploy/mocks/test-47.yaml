version: api.keploy.io/v1beta1
kind: SQL
name: test-47-0
spec:
    metadata:
        name: SQL
        operation: PrepareContext
        query: '"INSERT INTO lists (uuid, name, type, optin, tags, description) VALUES($1, $2, $3, $4, $5, $6) RETURNING id;"'
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-47-1
spec:
    metadata:
        name: SQL
        operation: PrepareContext.NumInput
        type: SQL_DB
    type: int
    int: 6
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-47-2
spec:
    metadata:
        arguments: '[{ 1 0f57b3bc-6d16-4862-b0aa-8735bd524c62} { 2 poiuyt} { 3 public} { 4 double} { 5 {"fghj"}} { 6 }]'
        name: SQL
        operation: QueryContext
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-47-3
spec:
    metadata:
        name: SQL
        operation: QueryContext.Close
        type: SQL_DB
    type: table
    table:
        cols:
            - name: id
              type: int64
              precision: 0
              scale: 0
        rows:
            - '[`3` | ]'
    int: 0
    error:
        - nil
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-47-4
spec:
    metadata:
        name: SQL
        operation: PrepareContext.Close
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-47-5
spec:
    metadata:
        arguments: '[{ 1 3} { 2 <nil>} { 3 } { 4 0} { 5 1}]'
        name: SQL
        operation: QueryContext
        query: "\"WITH ls AS ( \tSELECT COUNT(*) OVER () AS total, lists.* FROM lists WHERE CASE WHEN $1 > 0 THEN id = $1 WHEN $2 != '' THEN uuid = $2::UUID WHEN $3 != '' THEN to_tsvector(name) @@ to_tsquery ($3) ELSE true END ORDER BY created_at desc OFFSET $4 LIMIT (CASE WHEN $5 < 1 THEN NULL ELSE $5 END) ), counts AS ( SELECT list_id, JSON_OBJECT_AGG(status, subscriber_count) AS subscriber_statuses FROM ( SELECT COUNT(*) as subscriber_count, list_id, status FROM subscriber_lists WHERE ($1 = 0 OR list_id = $1) GROUP BY list_id, status ) row GROUP BY list_id ) SELECT ls.*, subscriber_statuses FROM ls LEFT JOIN counts ON (counts.list_id = ls.id) ORDER BY created_at desc;\""
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-47-6
spec:
    metadata:
        name: SQL
        operation: QueryContext.Close
        type: SQL_DB
    type: table
    table:
        cols:
            - name: total
              type: int64
              precision: 0
              scale: 0
            - name: id
              type: int64
              precision: 0
              scale: 0
            - name: uuid
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: name
              type: string
              precision: 0
              scale: 0
            - name: type
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: optin
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: tags
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: description
              type: string
              precision: 0
              scale: 0
            - name: created_at
              type: time.Time
              precision: 0
              scale: 0
            - name: updated_at
              type: time.Time
              precision: 0
              scale: 0
            - name: subscriber_statuses
              type: <nil>
              precision: 0
              scale: 0
        rows:
            - '[`1` | `3` | `[48 102 53 55 98 51 98 99 45 54 100 49 54 45 52 56 54 50 45 98 48 97 97 45 56 55 51 53 98 100 53 50 52 99 54 50]` | `poiuyt` | `[112 117 98 108 105 99]` | `[100 111 117 98 108 101]` | `[123 102 103 104 106 125]` | `` | `"2023-01-09T07:05:03.629263Z"` | `"2023-01-09T07:05:03.629263Z"` | `<nil>` | ]'
            - '[`1` | `3` | `[48 102 53 55 98 51 98 99 45 54 100 49 54 45 52 56 54 50 45 98 48 97 97 45 56 55 51 53 98 100 53 50 52 99 54 50]` | `poiuyt` | `[112 117 98 108 105 99]` | `[100 111 117 98 108 101]` | `[123 102 103 104 106 125]` | `` | `"2023-01-09T07:05:03.629263Z"` | `"2023-01-09T07:05:03.629263Z"` | `<nil>` | ]'
    int: 0
    error:
        - nil
        - EOF
        - nil
