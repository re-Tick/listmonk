version: api.keploy.io/v1beta1
kind: SQL
name: test-26-0
spec:
    metadata:
        name: SQL
        operation: PrepareContext
        query: '"WITH prof AS ( SELECT id, uuid, email, name, attribs, status, created_at, updated_at FROM subscribers WHERE CASE WHEN $1 > 0 THEN id = $1 ELSE uuid = $2 END ), subs AS ( SELECT subscriber_lists.status AS subscription_status, (CASE WHEN lists.type = ''private'' THEN ''Private list'' ELSE lists.name END) as name, lists.type, subscriber_lists.created_at FROM lists LEFT JOIN subscriber_lists ON (subscriber_lists.list_id = lists.id) WHERE subscriber_lists.subscriber_id = (SELECT id FROM prof) ), views AS ( SELECT subject as campaign, COUNT(subscriber_id) as views FROM campaign_views LEFT JOIN campaigns ON (campaigns.id = campaign_views.campaign_id) WHERE subscriber_id = (SELECT id FROM prof) GROUP BY campaigns.id ORDER BY campaigns.id ), clicks AS ( SELECT url, COUNT(subscriber_id) as clicks FROM link_clicks LEFT JOIN links ON (links.id = link_clicks.link_id) WHERE subscriber_id = (SELECT id FROM prof) GROUP BY links.id ORDER BY links.id ) SELECT (SELECT email FROM prof) as email, COALESCE((SELECT JSON_AGG(t) FROM prof t), ''{}'') AS profile, COALESCE((SELECT JSON_AGG(t) FROM subs t), ''[]'') AS subscriptions, COALESCE((SELECT JSON_AGG(t) FROM views t), ''[]'') AS campaign_views, COALESCE((SELECT JSON_AGG(t) FROM clicks t), ''[]'') AS link_clicks;"'
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-26-1
spec:
    metadata:
        name: SQL
        operation: PrepareContext.NumInput
        type: SQL_DB
    type: int
    int: 2
    error: []
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-26-2
spec:
    metadata:
        arguments: '[{ 1 1} { 2 <nil>}]'
        name: SQL
        operation: QueryContext
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-26-3
spec:
    metadata:
        name: SQL
        operation: QueryContext.Close
        type: SQL_DB
    type: table
    table:
        cols:
            - name: email
              type: <nil>
              precision: 0
              scale: 0
            - name: profile
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: subscriptions
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: campaign_views
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: link_clicks
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: email
              type: <nil>
              precision: 0
              scale: 0
            - name: profile
              type: <nil>
              precision: 0
              scale: 0
            - name: subscriptions
              type: <nil>
              precision: 0
              scale: 0
            - name: campaign_views
              type: <nil>
              precision: 0
              scale: 0
            - name: link_clicks
              type: <nil>
              precision: 0
              scale: 0
        rows:
            - '[`<nil>` | `[123 125]` | `[91 93]` | `[91 93]` | `[91 93]` | ]'
    int: 0
    error:
        - nil
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-26-4
spec:
    metadata:
        name: SQL
        operation: PrepareContext.Close
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
