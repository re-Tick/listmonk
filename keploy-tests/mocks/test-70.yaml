version: api.keploy.io/v1beta1
kind: SQL
name: test-70-0
spec:
    metadata:
        name: SQL
        operation: PrepareContext
        query: '"INSERT INTO lists (uuid, name, type, optin, tags) VALUES($1, $2, $3, $4, $5) RETURNING id;"'
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-70-1
spec:
    metadata:
        name: SQL
        operation: PrepareContext.NumInput
        type: SQL_DB
    type: int
    int: 5
    error: []
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-70-2
spec:
    metadata:
        arguments: '[{ 1 f3d33c9c-f214-4006-8f13-9fe9ca5cabb1} { 2 poiuyt} { 3 public} { 4 double} { 5 {"fghj"}}]'
        name: SQL
        operation: QueryContext
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-70-3
spec:
    metadata:
        name: SQL
        operation: QueryContext.Close
        type: SQL_DB
    type: table
    table:
        cols:
            - name: id
              type: int64
              precision: 0
              scale: 0
        rows:
            - '[`12` | ]'
    int: 0
    error:
        - nil
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-70-4
spec:
    metadata:
        name: SQL
        operation: PrepareContext.Close
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-70-5
spec:
    metadata:
        arguments: '[{ 1 12} { 2 <nil>} { 3 } { 4 0} { 5 1}]'
        name: SQL
        operation: QueryContext
        query: "\"WITH ls AS ( \tSELECT COUNT(*) OVER () AS total, lists.* FROM lists WHERE CASE WHEN $1 > 0 THEN id = $1 WHEN $2 != '' THEN uuid = $2::UUID WHEN $3 != '' THEN name ILIKE $3 ELSE true END OFFSET $4 LIMIT (CASE WHEN $5 = 0 THEN NULL ELSE $5 END) ), counts AS ( SELECT list_id, JSON_OBJECT_AGG(status, subscriber_count) AS subscriber_statuses FROM ( SELECT COUNT(*) as subscriber_count, list_id, status FROM subscriber_lists WHERE ($1 = 0 OR list_id = $1) GROUP BY list_id, status ) row GROUP BY list_id ) SELECT ls.*, subscriber_statuses FROM ls LEFT JOIN counts ON (counts.list_id = ls.id) ORDER BY created_at desc;\""
        type: SQL_DB
    type: error
    int: 0
    error:
        - nil
---
version: api.keploy.io/v1beta1
kind: SQL
name: test-70-6
spec:
    metadata:
        name: SQL
        operation: QueryContext.Close
        type: SQL_DB
    type: table
    table:
        cols:
            - name: total
              type: int64
              precision: 0
              scale: 0
            - name: id
              type: int64
              precision: 0
              scale: 0
            - name: uuid
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: name
              type: string
              precision: 0
              scale: 0
            - name: type
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: optin
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: tags
              type: '[]uint8'
              precision: 0
              scale: 0
            - name: created_at
              type: time.Time
              precision: 0
              scale: 0
            - name: updated_at
              type: time.Time
              precision: 0
              scale: 0
            - name: subscriber_statuses
              type: <nil>
              precision: 0
              scale: 0
        rows:
            - '[`1` | `12` | `[102 51 100 51 51 99 57 99 45 102 50 49 52 45 52 48 48 54 45 56 102 49 51 45 57 102 101 57 99 97 53 99 97 98 98 49]` | `poiuyt` | `[112 117 98 108 105 99]` | `[100 111 117 98 108 101]` | `[123 102 103 104 106 125]` | `"2022-12-18T19:25:08.026439Z"` | `"2022-12-18T19:25:08.026439Z"` | `<nil>` | ]'
            - '[`1` | `12` | `[102 51 100 51 51 99 57 99 45 102 50 49 52 45 52 48 48 54 45 56 102 49 51 45 57 102 101 57 99 97 53 99 97 98 98 49]` | `poiuyt` | `[112 117 98 108 105 99]` | `[100 111 117 98 108 101]` | `[123 102 103 104 106 125]` | `"2022-12-18T19:25:08.026439Z"` | `"2022-12-18T19:25:08.026439Z"` | `<nil>` | ]'
    int: 0
    error:
        - nil
        - EOF
        - nil
